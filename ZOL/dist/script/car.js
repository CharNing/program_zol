"use strict";function getcookie(){var e=$(".menu .buynum"),i=$(".car-state p span");if($.cookie("goodsid")&&$.cookie("goodsnum")){for(var t=$.cookie("goodsid").split(","),n=$.cookie("goodsnum").split(","),s=0;s<t.length;s++)render(t[s],n[s]);i.html(t.length),e.html(t.length)}changeNum(),del(),clear(),inputNum(),chose()}function render(n,s){var a=$(".order-table");$.ajax({type:"get",url:"http://10.31.155.61/program_zol/ZOL/php/shoplist.php",dataType:"json"}).done(function(e){for(var i=0;i<e.length;i++)if(e[i].sid===n){var t="";t+='\n                <tr class = \'goodslist\'>\n                    <td class="car-items">\n                        <input type="checkbox" class="choose select" checked>\n                        <a href="#" class="pic" target="_blank">\n                            <img src="'+e[i].url+'">\n                        </a>\n                        <div class="inforbox">\n                            <h3 class="tit">\n                                <a href="#" title="'+e[i].headline+'">\n                                '+e[i].headline+'\n                                </a>\n                            </h3>\n                            <div class="clear_fix">\n                                <a href="#" title="7天退换货" class="security seven"></a>\n                            </div>\n                            <p>颜色：中文原包</p>\n                            <div class="info-con">\n                                <span>套装：官方标配</span>\n                                <div class="info-help">\n                                    <h5>官方标配：</h5>\n                                    <p>中文原包</p>\n                                </div>\n                            </div>\n                        </div>\n                    </td>\n                    <td class="car-price ">\n                        <em class="old-price">'+e[i].oldprice+"</em>\n                        <em class='new-price'>"+e[i].newprice+'</em>\n                    </td>\n                    <td class="count">\n                        <div class="buynum">\n                            <a href="javascript:;" class="minus" sid='+(i+1)+'>-</a>\n                            <input type="text" class="amount" sid='+(i+1)+' value="'+s+'">\n                            <a href="javascript:;" class="add " sid='+(i+1)+'>+</a>\n                        </div>\n                    </td>\n                    <td class="discount">\n                        \x3c!-- <span class="tg">团购</span> --\x3e\n                        <p class="time">\n                            --\n                        </p>\n                    </td>\n                    <td>\n                        <em class="total-price subprice">'+s*e[i].newprice+'</em>\n                    </td>\n                    <td class="del">\n                        <div class="delbox">\n                            <a href="javascript:;" title="移入收藏夹">移入收藏夹</a>\n                            <a href="javascript:;" class = \'remove\'>删除</a>\n                            \x3c!-- 点击删除按钮显示此提示 --\x3e\n                            <div class="deltip">\n                                <p>确认要删除该商品吗？</p>\n                                <a href="javascript:;" class=\'y\' sid='+(i+1)+">是的</a>\n                                <a href=\"javascript:;\" class='n'>取消</a>\n                                <i></i>\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n                    ",a.children().append(t)}}).done(function(){var e=$("#all"),i=$(".choose").not("#all");e.on("click",function(){$(this).prop("checked")?i.prop("checked",!0):i.prop("checked",!1)});var t=i.length;i.on("click",function(){$(".car-items input:checked").length===t?e.prop("checked",!0):e.prop("checked",!1)}),finalPrice()})}function changeNum(){var e=$(".order-table"),c=null,o=null;e.delegate("a","click",function(e){var i=$.cookie("goodsnum").split(","),t=$.cookie("goodsid").split(","),n=$(this).parents(".count").prev().children(".new-price").html(),s=$(this).parents(".count").siblings().children(".total-price"),a=$(e.target);a.hasClass("add")&&(c=$(this).prev().val(),o=t.indexOf($(this).attr("sid")),++c<99||(c=99),$(this).prev().val(c)),a.hasClass("minus")&&(c=$(this).next().val(),o=t.indexOf($(this).attr("sid")),0<--c||(c=1),$(this).next().val(c)),s.html(n*c),finalPrice(),i[o]=c,$.cookie("goodsnum",i.toString(),{expires:30})})}function inputNum(){var e=$(".order-table"),a=null;e.delegate("input","blur",function(){var e=$.cookie("goodsnum").split(","),i=$.cookie("goodsid").split(",");if($(this).hasClass("amount")){var t=$(this).parents("td").siblings(".car-price").find(".new-price").html(),n=$(this).parents("td").siblings("td").find(".total-price"),s=$(this).val();a=i.indexOf($(this).attr("sid")),s<=0&&($(this).val(1),s=1),99<=s&&($(this).val(99),s=99),n.html(t*s),finalPrice(),e[a]=s,$.cookie("goodsnum",e.toString(),{expires:30})}})}function del(){var e=$(".order-table"),c=$(".car-state p span"),o=$(".shops");e.delegate("a","click",function(e){$(e.target).hasClass("remove")&&$(this).next().show(),$(".deltip").delegate("a","click",function(e){var i=$(e.target);if(i.hasClass("y")){var t=$.cookie("goodsnum").split(","),n=$.cookie("goodsid").split(","),s=$(this).attr("sid"),a=n.indexOf(s);t[a]="",t=t.filter(function(e){return""!==e}),n[a]="",n=n.filter(function(e){return""!==e}),$.cookie("goodsid",n.toString(),{expires:30}),$.cookie("goodsnum",t.toString(),{expires:30}),""==t&&($.cookie("goodsid","",{expires:-1}),$.cookie("goodsnum","",{expires:-1})),$(this).parents("tr").remove(),c.html(n.length),o.html(n.length)}else i.hasClass("n")&&$(this).parent().hide();finalPrice()})})}function clear(){$(".delt").on("click",function(){confirm("确认要清空购物车？")&&($.cookie("goodsid","",{expires:-1}),$.cookie("goodsnum","",{expires:-1}),$(".goodslist").remove(),$(".account").html(0),$(".car-state p span").html(0))})}function finalPrice(){for(var e=$(".subprice"),i=$(".total-price").not(".subprice"),t=[],n=0;n<e.length;n++)t.push(+$(e[n]).html());var s=t.reduce(function(e,i,t,n){return e+i},0);i.html(s)}function chose(){var e=$(".order-table"),i=$(".total-price").not(".subprice");e.delegate("input","click",function(){if($(this).hasClass("select")){var e=$(this).parent().siblings("td").find(".subprice").html();$(this).prop("checked")?i.html(Number(i.html())+Number(e)):i.html(i.html()-e)}else $(this).hasClass("allSelect")&&($(this).prop("checked")?finalPrice():i.html(0))})}require(["config"],function(){require(["jquery","jqcookie"],function(){getcookie()})});